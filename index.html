<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HTML Tutorial</title>
</head>
<body>

  <h1>Hi</h1>
  <p>Hello</p>

  <h2>Try</h2>
  <p>
    <a href="https://tannyfolio.pages.dev">
      This is a link I think hehe.
    </a>
  </p>

  <h1>Add Scope: user:read:admin</h1>
  <p><strong>Setup.js</strong></p>

  <pre><code>
require('dotenv').config();
const axios = require('axios');
const fs = require('fs');
const path = require('path');
const querystring = require('querystring');

const TOKEN_PATH = path.join(__dirname, 'zoom_token.json');
const LOG_PATH = path.join(__dirname, 'completed_log.json');

async function getZoomAccessToken() {
    if (!fs.existsSync(TOKEN_PATH)) throw new Error("‚ùå Login first!");
    let tokenData = JSON.parse(fs.readFileSync(TOKEN_PATH));
    if (Date.now() >= tokenData.expires_at) {
        console.log('üîÑ Refreshing Token...');
        const credentials = Buffer.from(`${process.env.ZOOM_CLIENT_ID}:${process.env.ZOOM_CLIENT_SECRET}`).toString('base64');
        const res = await axios.post('https://zoom.us/oauth/token', 
            querystring.stringify({ grant_type: 'refresh_token', refresh_token: tokenData.refresh_token }),
            { headers: { 'Authorization': `Basic ${credentials}`, 'Content-Type': 'application/x-www-form-urlencoded' } }
        );
        tokenData = { access_token: res.data.access_token, refresh_token: res.data.refresh_token, expires_at: Date.now() + (res.data.expires_in * 1000) - 5000 };
        fs.writeFileSync(TOKEN_PATH, JSON.stringify(tokenData));
    }
    return tokenData.access_token;
}

async function fetchAllExisting() {
    try {
        const token = await getZoomAccessToken();
        console.log("üîç Starting COMPANY-WIDE Scan...");

        // 1. GET ALL USERS
        console.log("   üë• Fetching Staff List...");
        const usersRes = await axios.get('https://api.zoom.us/v2/users?page_size=300', { 
            headers: { 'Authorization': `Bearer ${token}` } 
        });
        
        const users = usersRes.data.users;
        console.log(`   ‚úÖ Found ${users.length} users in this account.`);

        let allIDs = [];
        const d = new Date();
        d.setMonth(d.getMonth() - 6); // Look back 6 months
        const fromDate = d.toISOString().split('T')[0];

        // 2. LOOP THROUGH EACH USER
        for (const user of users) {
            console.log(`\n   üë§ Scanning User: ${user.email} (${user.first_name} ${user.last_name})`);
            
            // Scan this user's recordings
            const url = `https://api.zoom.us/v2/users/${user.id}/recordings?from=${fromDate}&page_size=300`;
            try {
                const res = await axios.get(url, { headers: { 'Authorization': `Bearer ${token}` } });
                if (res.data.meetings && res.data.meetings.length > 0) {
                    console.log(`      üéâ Found ${res.data.meetings.length} recordings!`);
                    res.data.meetings.forEach(m => allIDs.push(m.uuid));
                } else {
                    console.log(`      (No recent recordings)`);
                }
            } catch (e) {
                console.log(`      ‚ö†Ô∏è Access Denied or Error for this user.`);
            }
        }

        const uniqueIDs = [...new Set(allIDs)];
        fs.writeFileSync(LOG_PATH, JSON.stringify(uniqueIDs, null, 2));
        console.log(`\n‚úÖ SETUP COMPLETE. Ignored ${uniqueIDs.length} total videos.`);

    } catch (error) {
        console.error("‚ùå Error:", error.response ? error.response.data : error.message);
        if (error.response && error.response.status === 403) {
            console.log("üí° HINT: Did you add the 'user:read:admin' scope and Re-Login?");
        }
    }
}

fetchAllExisting();
  </code></pre>

</body>
</html>
